#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Change to frontend directory
cd console-experience || exit 1

# 1. TypeScript type checking
echo "  â†’ TypeScript..."
npm run type-check || {
  echo "âŒ TypeScript errors found. Fix types before committing."
  exit 1
}

# 2. ESLint (allow warnings, block errors only)
echo "  â†’ ESLint..."
npm run lint || {
  echo "âŒ ESLint errors found. Run 'npm run lint:fix' to auto-fix."
  exit 1
}

# 3. Prettier formatting
echo "  â†’ Prettier..."
npm run format:check || {
  echo "âŒ Formatting errors found. Run 'npm run format' to auto-fix."
  exit 1
}

# 4. Rust Clippy
echo "  â†’ Clippy..."
cd src-tauri || exit 1
cargo clippy -- -D warnings || {
  echo "âŒ Clippy warnings found. Fix Rust code before committing."
  exit 1
}

# 5. Rustfmt
echo "  â†’ Rustfmt..."
cargo fmt -- --check || {
  echo "âŒ Rust formatting errors. Run 'cargo fmt' to auto-fix."
  exit 1
}

cd ../..

echo "âœ… All pre-commit checks passed!"
